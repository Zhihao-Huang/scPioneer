# IMPORTANT! Assign your OpenAI API key. See Vignette for details
Sys.setenv(OPENAI_API_KEY = 'sk-HgtySiUAhSLiZTlDRhNE7aEbERJOuSumUveDxYfAUy8YvDfM')
Sys.setenv(OPENAI_API_KEY = '')
source('~/Documents/GitHub/scPioneer/R/annotation.R')
library(openai)
library(scPioneer)
library(ellmer)
pbmc <- FindClusters(pbmc, resolution = 2)
Idents(pbmc) <- pbmc$seurat_clusters
markers <- FindAllMarkers(pbmc, logfc.threshold = 0.5, test.use = 'MAST', only.pos = T)
top10 <- markers %>% group_by(cluster) %>% top_n(10, avg_log2FC)

annodf <- anno_ellmer(top10)
#' # depends on local model ollama. First download and install Ollama, then install model with ollama pull llama3.2. Test on Mac.
annodf2 <- anno_ellmer(top10, llm_function = 'ollama',  return.content = F)
chat <- chat_ollama(
  system_prompt = NULL,
  turns = NULL,
  base_url = "http://localhost:11434",
  model = 'llama3.2',
  seed = 12345,
  api_args = list(),
  echo = NULL
)
content <- anno_ellmer(top10,return.content = T)
cat(content)
chat$chat(content)
